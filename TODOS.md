# Subs2Anki 项目改进计划

## 1. 代码质量改进

### 高优先级
- [ ] 修复 `services/store.ts` 中的 `fileHandle: any | null` 类型定义，替换为具体类型
- [ ] 消除所有 `@ts-ignore` 注释并解决相应的类型问题
- [ ] 为 `services/types.ts` 中的所有接口添加 JSDoc 注释
- [ ] 修复 `services/anki-connect.ts` 中的潜在 XSS 风险
- [ ] 为所有函数添加明确的返回类型注解

### 中优先级
- [ ] 重构 `App.tsx` 组件，将其拆分为更小的子组件
- [ ] 创建专门的容器组件来管理状态（VideoContainer、SubtitleContainer、CardContainer）
- [ ] 将复杂的事件处理逻辑提取到自定义 Hook 中
- [ ] 实现统一的错误处理机制
- [ ] 为第三方库创建更准确的类型声明

### 低优先级
- [ ] 为所有组件添加 PropTypes 或更详细的 TypeScript 类型
- [ ] 实现代码风格指南并配置 ESLint 和 Prettier
- [ ] 添加代码审查流程

## 2. 性能优化

### 高优先级
- [ ] 在 `App.tsx` 中修复内存泄漏风险，确保 `URL.revokeObjectURL` 在适当时候被调用
- [ ] 实现 FFmpeg 操作的并发控制，避免资源竞争
- [ ] 优化 `VideoPlayer` 组件中的视频元素内存管理
- [ ] 实现 IndexedDB 媒体文件的定期清理机制

### 中优先级
- [ ] 优化 `react-virtuoso` 配置以提高大量字幕行时的性能
- [ ] 实现音频提取的批处理和进度指示
- [ ] 优化图像压缩算法，根据屏幕尺寸动态调整质量
- [ ] 实现视频帧捕获的节流机制

### 低优先级
- [ ] 实现大文件的分块处理机制
- [ ] 添加上传/下载进度指示器
- [ ] 优化文件解析算法性能
- [ ] 实现更智能的缓存策略

## 3. 安全增强

### 高优先级
- [ ] 实现对用户上传文件的严格验证（类型、大小、内容）
- [ ] 使用 DOMPurify 库净化所有 HTML 内容
- [ ] 为 AnkiConnect API 调用添加请求验证和超时机制
- [ ] 实现对 AnkiConnect 返回数据的验证

### 中优先级
- [ ] 实现敏感数据的加密存储
- [ ] 添加数据传输加密机制
- [ ] 实现安全的本地存储方案
- [ ] 添加恶意内容检测机制

### 低优先级
- [ ] 实现访问控制机制
- [ ] 实现安全的文件访问权限管理
- [ ] 添加安全审计日志

## 4. 用户体验改进

### 高优先级
- [ ] 添加加载状态指示器（特别是在 FFmpeg 加载和音频提取时）
- [ ] 改进错误消息的用户友好性
- [ ] 为长时间操作添加进度条
- [ ] 添加操作确认对话框（如删除卡片）

### 中优先级
- [ ] 实现快捷键自定义功能
- [ ] 改进键盘导航的可用性
- [ ] 添加项目自动保存功能
- [ ] 优化字幕编辑的用户体验

### 低优先级
- [ ] 实现更灵活的模板系统
- [ ] 添加项目备份和恢复功能
- [ ] 支持高对比度模式和屏幕阅读器
- [ ] 添加用户引导教程

## 5. 测试覆盖

### 高优先级
- [ ] 为核心业务逻辑编写单元测试（字幕解析、时间戳处理等）
- [ ] 为 FFmpeg 服务编写单元测试
- [ ] 为状态管理逻辑编写测试
- [ ] 实现基本的组件渲染测试

### 中优先级
- [ ] 实现组件交互的集成测试
- [ ] 编写 AnkiConnect 服务的集成测试
- [ ] 实现端到端测试（主要工作流程）
- [ ] 添加错误处理场景的测试

### 低优先级
- [ ] 实现性能基准测试
- [ ] 添加压力测试和负载测试
- [ ] 建立持续测试流水线
- [ ] 实现测试覆盖率监控

## 6. 架构改进

### 高优先级
- [ ] 实现更清晰的服务层来处理业务逻辑
- [ ] 创建配置管理器统一管理应用设置
- [ ] 实现依赖注入以提高可测试性
- [ ] 为外部服务（如 AnkiConnect）创建适配器

### 中优先级
- [ ] 将全局状态按功能域拆分
- [ ] 实现状态持久化机制
- [ ] 创建错误边界组件
- [ ] 实现更灵活的国际化支持

### 低优先级
- [ ] 实现插件系统以支持功能扩展
- [ ] 创建主题系统以支持外观定制
- [ ] 实现微前端架构以支持模块化开发

## 7. 文档和维护

### 高优先级
- [ ] 为公共 API 添加 JSDoc 注释
- [ ] 更新 README.md 以反映最新功能和改进
- [ ] 添加架构图和数据流图

### 中优先级
- [ ] 创建开发者文档
- [ ] 添加部署指南
- [ ] 创建常见问题解答（FAQ）

### 低优先级
- [ ] 创建用户手册
- [ ] 添加 API 参考文档
- [ ] 创建贡献指南

## 8. 特定功能改进

### 字幕处理功能
- [ ] 优化字幕解析算法以支持更多格式变体
- [ ] 添加字幕搜索和过滤功能

### 音频处理功能
- [ ] 优化音频提取性能
- [ ] 添加音频质量调节选项
- [ ] 实现音频格式转换功能
- [ ] 添加音频预览功能

### 视频处理功能
- [ ] 优化视频帧捕获性能
- [ ] 添加视频质量调节选项
- [ ] 实现视频格式转换功能
- [ ] 添加视频预览功能

### Anki 集成功能
- [ ] 优化 AnkiConnect 同步性能
- [ ] 添加同步进度指示
- [ ] 实现批量同步功能
- [ ] 添加同步错误重试机制

## 9. 可访问性改进
- [ ] 为所有交互元素添加适当的 ARIA 属性
- [ ] 确保键盘导航的可用性
- [ ] 实现焦点管理
- [ ] 添加颜色对比度检查

## 10. 部署和运维
- [ ] 优化构建配置以减小包体积
- [ ] 实现代码分割以提高加载性能
- [ ] 添加错误监控和报告机制
- [ ] 实现性能监控

## 11. 未来功能规划
- [ ] 集成 AI 翻译和注释功能